!function(){"use strict";var e=lodash,t=cf.core;function n(a,r,o){return(a=(0,e.cloneDeep)(a)).id=(0,t.uniqueId)(),a.container_id=r,"complex"===a.type&&a.value.forEach((e=>{e.id=(0,t.uniqueId)(),e.container_id=r,e.fields=e.fields.map((e=>n(e,r,o)))})),o.push(a),(0,e.pick)(a,["id","type","name","base_name"])}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,"string");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{uniqueId:i}=window.cf.core,{jQuery:s,ajaxurl:c,cyberpressAdminVariables:l}=window,{cloneDeep:d}=window.lodash,{withSelect:u,withDispatch:p}=wp.data,{Component:m}=wp.element,{addFilter:h}=wp.hooks,{compose:f,createHigherOrderComponent:_}=wp.compose,{__:b}=wp.i18n,g=_((e=>{const t=u(((e,t)=>{const{getFields:n,getFieldById:a,getComplexGroupValues:r}=e("carbon-fields/metaboxes"),{compactInput:o,compactInputKey:i}=window.cf.config,s=a(t.id),{value:c}=s;let l=t.name||s.name;return o&&!t.name&&-1===l.indexOf("widget-carbon_fields")&&(l=`${i}[${l}]`),{getFieldById:a,getComplexGroupValues:r,allFields:n(),field:s,name:l,value:c}})),a=p((e=>{const{addFields:t,cloneFields:n,removeFields:a,updateFieldValue:r}=e("carbon-fields/metaboxes");return{onChange:r,addFields:t,cloneFields:n,removeFields:a}}));return f(t,a)(class extends m{constructor(){super(...arguments),this.state={changedTeams:{},changedTournaments:{}}}componentDidMount(){const{allFields:e}=this.props;Object.keys(e).forEach((t=>{const n=e[t];"cyberpress_match_tournament"===n.base_name&&"carbon_fields_container_tournament"===n.container_id&&""===n.value&&s("#carbon_fields_container_tournament_stage").hide()}))}componentDidUpdate(){const{field:e}=this.props;"team_name"===e.base_name&&"carbon_fields_container_match_information"===e.container_id&&this.maybeAddTeamPlayers(e),"cyberpress_match_tournament"===e.base_name&&"carbon_fields_container_tournament"===e.container_id&&this.maybeChangeTournamentStage(e)}maybeChangeTournamentStage(e){const{allFields:t}=this.props,{changedTournaments:n}=this.state;if(!e.value)return void s("#carbon_fields_container_tournament_stage").hide();if(s("#carbon_fields_container_tournament_stage").show(),n[e.id]&&n[e.id]===e.value)return;let a=0;Object.keys(t).forEach((e=>{const n=t[e];a||"cyberpress_match_tournament_stage"!==n.base_name||"carbon_fields_container_tournament_stage"!==n.container_id||(a=n.id)})),a&&e.value&&(this.addStage(e.value,a),this.setState({changedTournaments:r(r({},n),{},{[e.id]:e.value})}))}addStage(e,t){const{getFieldById:n,onChange:a}=this.props,r=n(t),o={action:"cyberpress_get_tournament_stages",tournament_id:e,nonce:l.nonce};s.post(c,o,(e=>{const n=JSON.parse(e);0!==n.length?void 0!==r.options&&(r.options=[],Object.keys(n).forEach((e=>{r.options.push({value:Number(e),label:n[e].stage})})),a(t,r)):(r.options=[{value:0,label:b("Choose stage of tournament")}],a(t,r))}))}maybeAddTeamPlayers(e){const{allFields:t}=this.props,{changedTeams:n}=this.state;if(!e.value)return;if(n[e.id]&&n[e.id]===e.value)return;const a=[];Object.keys(t).forEach((n=>{const r=t[n];"players"===r.base_name&&"carbon_fields_container_match_information"===r.container_id&&s(".cf-container-carbon_fields_container_match_information .cf-complex__group.cf-complex__group--tabbed").each((function(){void 0===s(this).attr("hidden")&&0<s(this).find(`#${e.id}`).length&&0<s(this).find(`[for="${r.id}"]`).length&&a.push(r.id)}))})),0<a.length&&Object.keys(a).forEach((t=>{this.deletePlayers(e.value,a[t]),this.addPlayers(e.value,a[t]),this.setState({changedTeams:r(r({},n),{},{[e.id]:e.value})})}))}deletePlayers(e,t){const{onChange:n,getComplexGroupValues:a}=this.props,r=a(t);r&&r.players&&n(t,[])}addPlayers(e,t){const{getFieldById:a,addFields:r,onChange:o,getComplexGroupValues:u}=this.props,p=a(t),m=u(t),h=[],f=[],_=[];if(!p.groups||!p.groups[0])return;const b={action:"cyberpress_get_team_players",team_id:e,nonce:l.nonce};s.post(c,b,(e=>{const a=JSON.parse(e);if(0<a.length)for(let e=0;e<a.length;e+=1)_.push(a[e].player);0<_.length&&(Object.keys(_).forEach((e=>{h[e]=d(p.groups[0]);const a=[];h[e].id=i(),h[e].container_id=t,h[e].fields=h[e].fields.map((e=>n(e,t,a))),h[e].collapsed=!1,a[0].value=String(_[e]),f.push(a[0])})),r(f),m&&m.players&&o(t,m.players.concat(h)))}))}render(){const{props:t}=this;return wp.element.createElement(e,t)}})}),"withListenerRepeater");h("carbon-fields.field-edit.metabox","carbon-fields/metaboxes",g)}();